<html>
    <head>
        <title>Mona Lisa Supervising</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="UTF-8"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="./website.css">

    </head>
    <body>
        <h1 class="text-center">Mona Lisa is Safe</h1> <!--Il faudra faire varier la valeur de Safe/in Danger/has been Stolen en fonction de l'alterte que l'on renvoit-->
        <div class="pct" style="margin-top: 3em;">
            <img src="../joconde.jpg" class="mx-auto d-block" style="height: 20em;">
        </div>
        <div class="container btn justify-content-between d-flex" style="margin-top: 3em;">
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="temp">
                Temperature
            </button>
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="hum">
                Humidity
            </button>
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="acc">
                Acceleration
            </button>
            <div class="dropdown-menu">
                <a class="dropdown-item" id="live">Live</a>
                <a class="dropdown-item" id="m">1m</a>
                <a class="dropdown-item" id="h">1h</a>
                <a class="dropdown-item" id="d">1d</a>
                <a class="dropdown-item" id="w">1w</a>
                <a class="dropdown-item" id="m">1m</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" id="cd">Choose Date</a>
            </div>
        </div>
        <div class="nptndchrt">
            <div class="npt"> <!--A voir pour cacher le input et le sortir quand on choisit choose date. Il faut aussi configurer la sortie sur node-red pour mongo-db-->
                <div class="container-fluid" style="margin-top: 3em;">
                    <div class="row justify-content-between d-flex form-group">
                        <div class="col d-flex justify-content-start" id="datetemp" style="visibility:hidden;">
                            <label for="choose temp date">Choose Date</label>
                            <input type="date" class="form-control"  aria-describedby="choosedate" placeholder="Enter Date" style="width: 70%;">
                        </div>
                        <div class="col d-flex justify-content-center" id="datehum" style="visibility:hidden;">
                            <label for="choose hum date">Choose Date</label>
                            <input type="date" class="form-control" aria-describedby="emailHelp" placeholder="Enter Date" style="width: 70%;">
                        </div>
                        <div class="col d-flex justify-content-end" id="dateacc" style="visibility:hidden;">
                            <label for="choose acc date">Choose Date</label>
                            <input type="date" class="form-control" aria-describedby="emailHelp" placeholder="Enter Date" style="width: 70%;">
                        </div>
                    </div>
                </div>
            </div>
            <div class="chart"> <!--A voir pour sortir le chart en fonction de l'appui sur le bouton. Il faut voir quelle librairies de chart on utilise, et afficher le bon chart en fonction du retour bouton-->
                <div class="container" style="margin-top: 3em;">
                    <div class="row justify-content-around">
                        <div class="col d-flex justify-content-start">
                        </div>
                        <div class="col d-flex justify-content-center">
                        </div>
                        <div class="col d-flex justify-content-end">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript" src='./website.js'></script>
        <script src="mqttws31.js" type="text/javascript"></script>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js" integrity="sha512-hZf9Qhp3rlDJBvAKvmiG+goaaKRZA6LKUO35oK6EsM0/kjPK32Yw7URqrq3Q+Nvbbt8Usss+IekL7CRn83dYmw==" crossorigin="anonymous"></script>
    </body>
</html>

<script>
    var mqtt;
var reconnectTimeout = 2000;
function MQTTconnect() {
	mqtt = new Paho.MQTT.Client("192.168.1.72",1883,"/mqtt","web_" + parseInt(Math.random() * 100, 10) );
	var options = {
		timeout: 3,
		useSSL: false,
		cleanSession: true,
		onSuccess: onConnect,
		onFailure: function (message) {
			$('#status').val("Connection failed: " + message.errorMessage + "Retrying");
			setTimeout(MQTTconnect, reconnectTimeout);
		}
	};
	mqtt.onConnectionLost = onConnectionLost;
	mqtt.onMessageArrived = onMessageArrived;
	mqtt.connect(options);
}
function onConnect() {
	console.log('Connected to host ');
	mqtt.subscribe("Topic", {qos: 0});
	console.log('Topic');
}
function onConnectionLost(responseO) {
	setTimeout(MQTTconnect, reconnectTimeout);
	$('#status').val("connection lost: " + responseO.errorMessage + ". Reconnecting");
};
function onMessageArrived(message) {
	var topic = message.destinationName;
	var payload = message.payloadString;
	$('#ws').prepend('<li>' + topic + ' = ' + payload + '</li>');
};


$(document).ready(function() {
	MQTTconnect();
});


    $("#temp").click(function(){
        if(getComputedStyle(document.getElementById("datetemp")).visibility != "hidden"){
            document.getElementById("datetemp").style.visibility = "hidden";
        } else {
            document.getElementById("datetemp").style.visibility = "visible";
        }
    });
    $("#hum").click(function(){
        if(getComputedStyle(document.getElementById("datehum")).visibility != "hidden"){
            document.getElementById("datehum").style.visibility = "hidden";
        } else {
            document.getElementById("datehum").style.visibility = "visible";
        }
    });
    $("#acc").click(function(){
        if(getComputedStyle(document.getElementById("dateacc")).visibility != "hidden"){
            document.getElementById("dateacc").style.visibility = "hidden";
        } else {
            document.getElementById("dateacc").style.visibility = "visible";
        }
    });


</script>